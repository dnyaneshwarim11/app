<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Material Details</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <style>
    body {
      background-color: #1a1a1a; /* Black background */
      background-image: url('background.jpg'); /* Set background image */
      background-size: cover;
      background-position: center;
      color: #74de18; /* Parrot green text color */
      font-family: Arial, sans-serif;
    }

    h3 {
      color: #74de18; /* Parrot green color for the heading */
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.6); /* Shadow for text */
    }

    .container {
      background-color: rgba(0, 0, 0, 0.8); /* Semi-transparent black background */
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.8); /* Shadow for the form container */
      max-width: 600px;
      margin: 100px auto; /* Center the container */
    }

    .color-box {
      width: 15px;
      height: 15px;
      display: inline-block;
      border-radius: 4px;
      margin-right: 8px;
    }

    .history-entry {
      border-bottom: 1px solid #333;
      padding: 4px 0;
      color: #ccc;
    }

    .btn-warning, .btn-success, .btn-secondary {
      font-weight: bold;
    }

    .btn-warning {
      background-color: #ffcc00;
      border-color: #ffcc00;
    }

    .btn-warning:hover {
      background-color: #e6b800;
    }

    .btn-success {
      background-color: #74de18;
      border-color: #74de18;
    }

    .btn-success:hover {
      background-color: #5dbd12;
    }

    .btn-secondary {
      background-color: #000000;
      color: #74de18;
      border: 1px solid #74de18;
    }

    .btn-secondary:hover {
      background-color: #000000;
      color: #74de18;
    }

    .form-label {
      color: #74de18; /* Parrot green for labels */
    }

    .form-control {
      background-color: #333333; /* Dark background for input fields */
      color: #74de18; /* Parrot green text in input fields */
      border: 1px solid #74de18; /* Parrot green border */
    }

    .form-control:focus {
      border-color: #74de18; /* Parrot green border on focus */
      background-color: #444444; /* Slightly lighter background on focus */
    }

    .btn, .form-control {
      transition: all 0.3s ease-in-out; /* Smooth transition for buttons and inputs */
    }

    .btn:hover, .form-control:focus {
      transform: scale(1.05); /* Slight scaling effect on hover/focus */
    }

    .history-entry:hover {
      background-color: #333333;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h3><span class="color-box" id="materialColorBox"></span><span id="materialTitle">Material Name</span></h3>
    <p><strong>Total:</strong> <span id="total"></span>g</p>
    <p><strong>Used:</strong> <span id="used"></span>g</p>
    <p><strong>Remaining:</strong> <span id="remaining"></span>g</p>

    <div class="mb-3">
      <label for="useInput" class="form-label">Use Material (grams)</label>
      <input type="number" id="useInput" class="form-control" />
      <button class="btn btn-warning mt-2" onclick="useMaterial()">Use</button>
    </div>

    <div class="mb-3">
      <label for="addInput" class="form-label">Add Material (grams)</label>
      <input type="number" id="addInput" class="form-control" />
      <button class="btn btn-success mt-2" onclick="addMaterial()">Add</button>
    </div>

    <h5 class="mt-4">Usage History</h5>
    <div id="historyContainer" class="border p-2 rounded bg-black"></div>

    <button class="btn btn-secondary mt-4" onclick="window.close()">Back</button>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const name = params.get('name');
    let total = parseFloat(params.get('total'));
    let used = parseFloat(params.get('used'));
    const color = params.get('color');
    let history = [];

    try {
      history = JSON.parse(params.get('history')) || [];
    } catch (err) {
      history = [];
    }

    const materialTitle = document.getElementById('materialTitle');
    const materialColorBox = document.getElementById('materialColorBox');
    const totalEl = document.getElementById('total');
    const usedEl = document.getElementById('used');
    const remainingEl = document.getElementById('remaining');
    const historyContainer = document.getElementById('historyContainer');

    materialTitle.textContent = name;
    materialColorBox.style.backgroundColor = color;

    function updateDisplay() {
      totalEl.textContent = total;
      usedEl.textContent = used;
      remainingEl.textContent = total - used;
      renderHistory();
    }

    function renderHistory() {
      historyContainer.innerHTML = '';
      if (history.length === 0) {
        historyContainer.innerHTML = '<p class="text-muted">No usage history yet.</p>';
        return;
      }

      history.slice().reverse().forEach(entry => {
        const div = document.createElement('div');
        div.className = 'history-entry';
        div.textContent = `${entry.type} ${entry.amount}g on ${entry.date}`;
        historyContainer.appendChild(div);
      });
    }

    function useMaterial() {
      const input = document.getElementById('useInput');
      const amount = parseFloat(input.value);
      if (!isNaN(amount) && amount > 0 && used + amount <= total) {
        used += amount;
        history.push({ type: 'Used', amount, date: new Date().toLocaleString() });
        input.value = '';
        updateDisplay();
      } else {
        alert('Invalid input or exceeds total.');
      }
    }

    function addMaterial() {
      const input = document.getElementById('addInput');
      const amount = parseFloat(input.value);
      if (!isNaN(amount) && amount > 0) {
        total += amount;
        history.push({ type: 'Added', amount, date: new Date().toLocaleString() });
        input.value = '';
        updateDisplay();
      } else {
        alert('Invalid input.');
      }
    }

    updateDisplay();
  </script>
</body>
</html>
